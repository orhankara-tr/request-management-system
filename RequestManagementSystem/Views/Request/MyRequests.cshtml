@using PagedList
@using PagedList.Mvc
@using EntityLayer.Concrete
@model PagedList.IPagedList<Request>

@{
    ViewBag.Title = "Taleplerim";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0 text-dark">Taleplerim</h1>
            </div>
        </div>
    </div>
</div>

<section class="content">
    <div class="container-fluid">
        <div class="card card-outline card-primary shadow mb-3">
            <div class="card-body pt-2 pb-2">
                @using (Html.BeginForm("MyRequests", "Request", FormMethod.Get, new { id = "filterForm", @class = "form-inline" }))
                {
                    <div class="form-group mr-2 mb-2">
                        <label class="mr-2 mb-0 small text-dark">Başlangıç Tarihi</label>
                        <input type="date" id="startDate" name="startDate"
                               value="@(ViewBag.StartDate != null ? ((DateTime)ViewBag.StartDate).ToString("yyyy-MM-dd") : "")"
                               class="form-control" />
                    </div>
                    <div class="form-group mr-2 mb-2">
                        <label class="mr-2 mb-0 small text-dark">Bitiş Tarihi</label>
                        <input type="date" id="endDate" name="endDate"
                               value="@(ViewBag.EndDate != null ? ((DateTime)ViewBag.EndDate).ToString("yyyy-MM-dd") : "")"
                               class="form-control" />
                    </div>

                    <button type="submit" class="btn btn-primary mb-2 mr-2">
                        <i class="fas fa-search"></i> Filtrele
                    </button>
                    <a href="/Request/MyRequests" class="btn btn-secondary mb-2">
                        <i class="fas fa-times"></i> Temizle
                    </a>
                }
            </div>
        </div>

        <div class="card">
            <div class="card-body p-0">
                <table class="table table-striped table-valign-middle">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Talep No</th>
                            <th>Başlık</th>
                            <th>Tür</th>
                            <th>Öncelik</th>
                            <th>Durum</th>
                            <th>Oluşturma Tarihi</th>
                            <th>Yönetici Notu</th>
                            <th style="width: 150px;" class="text-right">İşlemler</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var req in Model)
                        {
                            <tr>
                                <td>@req.RequestId</td>
                                <td>
                                    <span class="badge badge-secondary" style="font-size: 0.98em">@req.RequestNo</span>
                                </td>
                                <td>@req.Title</td>
                                <td>
                                    @{
                                        string turClass = "badge";
                                        string turText = "";
                                        switch ((RequestType)req.RequestTypeId)
                                        {
                                            case RequestType.HataRaporu: turClass += " badge-primary"; turText = "Hata Raporu"; break;
                                            case RequestType.Destek: turClass += " badge-warning"; turText = "Destek"; break;
                                            case RequestType.OzellikTalebi: turClass += " badge-info"; turText = "Özellik Talebi"; break;
                                            default: turClass += " badge-secondary"; turText = "Bilinmiyor"; break;
                                        }
                                    }
                                    <span class="@turClass">@turText</span>
                                </td>
                                <td>
                                    @{
                                        string priorityClass = "badge";
                                        string priorityText = "";
                                        switch ((Priority)req.PriorityId)
                                        {
                                            case Priority.Yuksek: priorityClass += " badge-danger"; priorityText = "Yüksek"; break;
                                            case Priority.Orta: priorityClass += " badge-warning"; priorityText = "Orta"; break;
                                            case Priority.Dusuk: priorityClass += " badge-secondary"; priorityText = "Düşük"; break;
                                            default: priorityClass += " badge-secondary"; priorityText = "Bilinmiyor"; break;
                                        }
                                    }
                                    <span class="@priorityClass">@priorityText</span>
                                </td>
                                <td>
                                    @{
                                        string statusClass = "badge";
                                        string statusText = "";
                                        switch ((RequestStatus)req.StatusId)
                                        {
                                            case RequestStatus.Onaylandi: statusClass += " badge-success"; statusText = "Onaylandı"; break;
                                            case RequestStatus.Taslak: statusClass += " badge-info"; statusText = "Taslak"; break;
                                            case RequestStatus.OnayBekliyor: statusClass += " badge-warning"; statusText = "Onay Bekliyor"; break;
                                            case RequestStatus.Reddedildi: statusClass += " badge-danger"; statusText = "Reddedildi"; break;
                                            default: statusClass += " badge-secondary"; statusText = "Bilinmiyor"; break;
                                        }
                                    }
                                    <span class="@statusClass">@statusText</span>
                                </td>
                                <td>@req.CreatedDate.ToString("dd.MM.yyyy")</td>
                                <td>
                                    @if (!string.IsNullOrEmpty(req.ApprovalNotes))
                                    {
                                        <small class="text-muted"><i class="fas fa-comment-dots mr-1"></i> @req.ApprovalNotes</small>
                                    }
                                    else
                                    {
                                        <span class="text-italic small text-secondary">Not yok.</span>
                                    }
                                </td>
                                <td class="text-right">
                                    <div class="btn-group">
                                        <a href="@Url.Action("Details", "Request", new { id = req.RequestId })" class="btn btn-default btn-sm border shadow-sm" title="Detay">
                                            <i class="fas fa-eye text-primary"></i>
                                        </a>
                                        @if (req.StatusId == RequestStatus.Taslak)
                                        {
                                            <a href="@Url.Action("Edit", "Request", new { id = req.RequestId })" class="btn btn-warning btn-sm border shadow-sm" title="Düzenle">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <a href="@Url.Action("Submit", "Request", new { id = req.RequestId })" class="btn btn-info btn-sm" title="Onaya Gönder">
                                                <i class="fas fa-paper-plane"></i>
                                            </a>
                                        }
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="card-footer clearfix">
                @Html.PagedListPager(Model, page => Url.Action("MyRequests", new
                {
                    page = page,
                    startDate = ViewBag.StartDate != null ? ((DateTime)ViewBag.StartDate).ToString("yyyy-MM-dd") : null,
                    endDate = ViewBag.EndDate != null ? ((DateTime)ViewBag.EndDate).ToString("yyyy-MM-dd") : null
                }), new PagedListRenderOptions
                {
                    LiElementClasses = new List<string> { "page-item" },
                    UlElementClasses = new List<string> { "pagination pagination-sm m-0 float-right" }
                })
            </div>
        </div>
    </div>
</section>
